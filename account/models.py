#from __future__ import unicode_literalsfrom django.db import modelsfrom django.conf import settings#画面認証用from django.utils.encoding import python_2_unicode_compatiblefrom django.contrib.auth.models import AbstractBaseUser, BaseUserManager, PermissionsMixin##from datetime import datetime#変更した場合、テンプレートの検索欄も要変更ACCOUNT_TYPE_CHOICES = (    ('', settings.EMPTY_MARK),    (1, '普通'),    (2, '当座'),)TRADE_DIVISION_CHOICES = (    (0, '外注・工事仕入'),    (1, '経費'),)PAY_DAY_DIVISION_CHOICES = (    (0, '当月'),    (1, '翌月'),    (2, '翌々月'),    (3, '月末(休日前倒し)'),    (4, '月末(休日先送り)'),)PAYMENT_METHOD_CHOICES = (    ('', settings.EMPTY_MARK),    (1, '振込'),    (2, '口座振替'),    (3, 'ＡＴＭ'),    (4, '現金'),)FIXED_CONTENT_CHOICES = (    ('', settings.EMPTY_MARK),    (1, '項目のみ'),    (2, '項目のみ（指定月）'),    (3, '項目・固定費'),    (4, '項目・固定費（指定月）'),    (5, '項目・概算＝仕入金額'),)# Create your models here.class Bank(models.Model):    """銀行マスター"""    order = models.IntegerField('ソート順', blank=True, default=0)    name = models.CharField('銀行名', max_length=255)    created_at = models.DateTimeField('登録日時',auto_now_add=True, blank=True, null=True)    update_at = models.DateTimeField('更新日時',auto_now=True, blank=True, null=True)        def __str__(self):        return self.nameclass Bank_Branch(models.Model):    """銀行支店マスター"""    order = models.IntegerField('ソート順', blank=True, default=0)    #bank_id = models.IntegerField('銀行ID', blank=True, default=0)    bank = models.ForeignKey(Bank, verbose_name="銀行名", null=True, blank=True, on_delete=models.SET_NULL )    name = models.CharField('銀行支店名', max_length=255)    created_at = models.DateTimeField('登録日時',auto_now_add=True, blank=True, null=True)    update_at = models.DateTimeField('更新日時',auto_now=True, blank=True, null=True)        def __str__(self):        return self.name        class Account_Title(models.Model):    """勘定科目マスター"""    order = models.IntegerField('ソート順', blank=True, default=0)    name = models.CharField('勘定科目名', max_length=255)    trade_division_id = models.IntegerField('取引区分(0:経費 1:外注等)', blank=True, choices=TRADE_DIVISION_CHOICES, default=0)    created_at = models.DateTimeField('登録日時',auto_now_add=True, blank=True, null=True)    update_at = models.DateTimeField('更新日時',auto_now=True, blank=True, null=True)        #テンプレートにリストの選択値を表示させるためのもの    def trade_division_verbose(self):        return dict(TRADE_DIVISION_CHOICES)[self.trade_division_id]    def __str__(self):        return self.nameclass Partner(models.Model):    """取引先マスター"""    order = models.IntegerField('ソート順', blank=True, default=0)    administrative_name = models.CharField('取引先名(管理用)', max_length=255, blank=True)    name = models.CharField('取引先名', max_length=255)    trade_division_id = models.IntegerField('取引区分ID', blank=True, choices=TRADE_DIVISION_CHOICES, default=0)    #account_title_id = models.IntegerField('支払科目ID', blank=True, default=0)    account_title = models.ForeignKey(Account_Title, verbose_name="支払科目", null=True, blank=True, on_delete=models.SET_NULL)        payment_method_id = models.IntegerField('支払方法ID', blank=True, null=True, choices=PAYMENT_METHOD_CHOICES)            #add180417    #振込(振替)元--デフォはホクギンとする。    source_bank = models.ForeignKey(Bank, related_name='source_bank', verbose_name="振込/振替元銀行", null=True, blank=True, default=1, on_delete=models.SET_NULL)        #bank_id = models.IntegerField('振込先銀行', blank=True, default=0)    bank = models.ForeignKey(Bank, verbose_name="振込先銀行", null=True, blank=True, on_delete=models.SET_NULL)    bank_name = models.CharField('振込先銀行名', max_length=255)   #あとで抹消    #bank_branch_id = models.IntegerField('振込先銀行', blank=True, default=0)    bank_branch = models.ForeignKey(Bank_Branch, verbose_name="振込先支店名", null=True, blank=True, on_delete=models.SET_NULL)    branch_name = models.CharField('振込先支店名', max_length=255)  #あとで抹消    account_type = models.IntegerField('口座種別', blank=True, null=True, choices=ACCOUNT_TYPE_CHOICES)    #account_number = models.IntegerField('口座番号', blank=True, null=True)    account_number = models.CharField('口座番号', default="", blank=True, max_length=16)   #upd180312        #add180125    pay_day =  models.IntegerField('支払日', blank=True, default=0)    pay_day_division = models.IntegerField('支払フラグ(月末等)', default=0, choices=PAY_DAY_DIVISION_CHOICES )    #支払月フラグ    pay_month_flag_1 = models.BooleanField('１月', default=False)    pay_month_flag_2 = models.BooleanField('２月', default=False)    pay_month_flag_3 = models.BooleanField('３月', default=False)    pay_month_flag_4 = models.BooleanField('４月', default=False)    pay_month_flag_5 = models.BooleanField('５月', default=False)    pay_month_flag_6 = models.BooleanField('６月', default=False)    pay_month_flag_7 = models.BooleanField('７月', default=False)    pay_month_flag_8 = models.BooleanField('８月', default=False)    pay_month_flag_9 = models.BooleanField('９月', default=False)    pay_month_flag_10 = models.BooleanField('１０月', default=False)    pay_month_flag_11 = models.BooleanField('１１月', default=False)    pay_month_flag_12 = models.BooleanField('１２月', default=False)    #    fixed_content_id = models.IntegerField('固定項目フラグ', blank=True, null=True, choices=FIXED_CONTENT_CHOICES )    rough_estimate = models.IntegerField('概算', blank=True, null=True)    fixed_cost = models.IntegerField('固定費', blank=True, null=True)    #        created_at = models.DateTimeField('登録日時',auto_now_add=True, blank=True, null=True)    update_at = models.DateTimeField('更新日時',auto_now=True, blank=True, null=True)        #テンプレートにリストの選択値を表示させるためのもの    def trade_division_verbose(self):        return dict(TRADE_DIVISION_CHOICES)[self.trade_division_id]        #ex.モデル単位で取得する場合        #return dict(Scoop.FLAVOR_CHOCIES)[self.flavor]    def payment_method_verbose(self):    #支払方法        if self.payment_method_id != None:            return dict(PAYMENT_METHOD_CHOICES)[self.payment_method_id]        else:            return dict(PAYMENT_METHOD_CHOICES)['']    def account_type_verbose(self):    #口座種別        if self.account_type != None:          return dict(ACCOUNT_TYPE_CHOICES)[self.account_type]        else:          return dict(ACCOUNT_TYPE_CHOICES)['']    def __str__(self):        return self.nameclass Payment(models.Model):    """支払ファイル"""    order = models.IntegerField('ソート順', blank=True, default=0)    #billing_year_month = models.CharField('支払年月', max_length=6)    billing_year_month = models.DateField('請求〆年月')    trade_division_id = models.IntegerField('取引区分ID', null=True, blank=True, choices=TRADE_DIVISION_CHOICES)    #partner_id = models.IntegerField('取引先ID', blank=True, default=0)    partner = models.ForeignKey(Partner, verbose_name="取引先", null=True, blank=True, on_delete=models.SET_NULL)    #accounttitle_id = models.IntegerField('科目ID', blank=True, default=0)    account_title = models.ForeignKey(Account_Title, verbose_name="項目", null=True, blank=True, on_delete=models.SET_NULL)    billing_amount = models.IntegerField('請求金額', blank=True, null=True)    rough_estimate = models.IntegerField('概算', blank=True, null=True)            #add180417    payment_amount = models.IntegerField('支払金額', blank=True, null=True)    commission = models.IntegerField('手数料', blank=True, null=True)    #add end        payment_method_id = models.IntegerField('支払方法', blank=True, null=True, choices=PAYMENT_METHOD_CHOICES, default=0)        #add180417    #振込(振替)元    source_bank = models.ForeignKey(Bank, related_name='payment_source_bank', verbose_name="振込/振替元銀行", null=True, blank=True, on_delete=models.SET_NULL )    #add end        payment_due_date = models.DateField('支払予定日',blank=True, null=True)    payment_date = models.DateField('支払日',blank=True, null=True)    #fixed_cost = models.BooleanField('固定費', default=False)    note = models.CharField('備考', max_length=255,blank=True)    created_at = models.DateTimeField('登録日時',auto_now_add=True, blank=True, null=True)    update_at = models.DateTimeField('更新日時',auto_now=True, blank=True, null=True)     #テンプレートにリストの選択値を表示させるためのもの    def payment_method_verbose(self):        return dict(PAYMENT_METHOD_CHOICES)[self.payment_method_id]        #以下は認証用のモデル@python_2_unicode_compatibleclass AuthUserManager(BaseUserManager):    def create_user(self, username, email, password, last_name, first_name):        """        ユーザ作成        :param username: ユーザID        :param email: メールアドレス        :param password: パスワード        :param last_name: 苗字        :param first_name: 名前        :return: AuthUserオブジェクト        """        if not email:            raise ValueError('Users must have an email')        if not username:            raise ValueError('Users must have an username')        user = self.model(username=username,                          email=email,                          password=password,                          last_name=last_name,                          first_name=first_name)        user.is_active = True        user.set_password(password)        user.save(using=self._db)        return user    def create_superuser(self, username, email, password, last_name, first_name):        """        スーパーユーザ作成        :param username: ユーザID        :param email: メールアドレス        :param password: パスワード        :param last_name: 苗字        :param first_name: 名前        :return: AuthUserオブジェクト        """        user = self.create_user(username=username,                                email=email,                                password=password,                                last_name=last_name,                                first_name=first_name)        user.is_staff = True        user.is_superuser = True        user.save(using=self._db)        return user@python_2_unicode_compatibleclass AuthUser(AbstractBaseUser, PermissionsMixin):    """    ユーザ情報を管理する    """    class Meta:        verbose_name = 'ユーザ'        verbose_name_plural = 'ユーザ'    def get_short_name(self):        """        ユーザの苗字を取得する        :return: 苗字        """        return self.last_name    def get_full_name(self):        """        ユーザのフルネームを取得する        :return: 苗字 + 名前        """        return self.last_name + self.first_name    username = models.CharField(verbose_name='ユーザID',                                unique=True,                                max_length=30)    last_name = models.CharField(verbose_name='苗字',                                 max_length=30,                                 default=None)    first_name = models.CharField(verbose_name='名前',                                  max_length=30,                                  default=None)    email = models.EmailField(verbose_name='メールアドレス',                              null=True,                              default=None)    date_joined = models.DateTimeField(auto_now_add=True)    is_active = models.BooleanField(verbose_name='有効フラグ',                                    default=True)    is_staff = models.BooleanField(verbose_name='管理サイトアクセス権限',                                   default=False)    USERNAME_FIELD = 'username'    REQUIRED_FIELDS = ['email', 'last_name', 'first_name']    objects = AuthUserManager()    def __str__(self):        return self.last_name + ' ' + self.first_name###以上